# ğŸš¨ ERROR CRÃTICO: 401 Unauthorized en Planning Service

## ğŸ“Š **RESUMEN DEL PROBLEMA**
Las rutinas NO funcionan porque el **Planning Service** rechaza tokens vÃ¡lidos del **Identity Service** con error `401 Unauthorized`.

---

## ğŸ” **DETALLES TÃ‰CNICOS**

### **Error EspecÃ­fico:**
```
GET https://api.capbox.site/planning/v1/routines?nivel=Intermedio 401 (Unauthorized)
GET https://api.capbox.site/planning/v1/routines?nivel=Avanzado 401 (Unauthorized)
GET https://api.capbox.site/planning/v1/routines?nivel=Principiante 401 (Unauthorized)
GET https://api.capbox.site/planning/v1/routines?nivel=General 401 (Unauthorized)
```

### **Token Enviado (VÃLIDO):**
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxNDI3NDEwZC1kMzU4LTRhODYtODY0NS03MGE1NDE5YWEzZjQiLCJlbWFpbCI6ImFtaXphZGF5LmRldkBnbWFpbC5jb20iLCJyb2wiOiJFbnRyZW5hZG9yIiwiaXNzIjoiaHR0cHM6Ly93ZWItODdwY2t2M3pmazNxLnVwLWRlLWZyYTEtazhzLTEuYXBwcy5ydW4tb24tc2Vlbm9kZS5jb20gIiwiYXVkIjoiY2FwYm94LWFwcCIsImlhdCI6MTc1Mzg2OTg4NywiZXhwIjoxNzUzODczNDg3fQ.AjvX3juoCHu-Euu5dBn19HLU-p4QW128AhuKA9DM5f4
```

### **Token Decodificado:**
```json
{
  "sub": "14274100d-d358-4a86-8645-70a5419aa3f4",
  "email": "amizaday.dev@gmail.com", 
  "rol": "Entrenador",
  "iss": "https://web-87pckv3zfk3q.up-de-fra1-k8s-1.apps.run-on-seenode.com ",
  "aud": "capbox-app",
  "iat": 1753869887,
  "exp": 1753873487
}
```

---

## ğŸ”§ **VALIDACIONES NECESARIAS**

### **1. ConfiguraciÃ³n del Planning Service**
- Â¿El Planning Service usa la **misma clave secreta** que Identity Service?
- Â¿Valida el **mismo issuer** (`iss`)?
- Â¿Valida la **misma audience** (`aud`)?

### **2. Permisos y Roles**
- Â¿El rol `"Entrenador"` tiene permisos para `/planning/v1/routines`?
- Â¿Se requieren **scopes adicionales** en el token?
- Â¿El Planning Service lee el campo `rol` correctamente?

### **3. Middlewares de AutenticaciÃ³n**
- Â¿El Planning Service tiene middleware de JWT activado?
- Â¿Las rutas `/planning/v1/routines` estÃ¡n protegidas?
- Â¿Hay logs del Planning Service mostrando por quÃ© rechaza el token?

---

## ğŸ“ **ACCIONES REQUERIDAS**

### **INMEDIATAS:**
1. **Verificar logs del Planning Service** para este request especÃ­fico
2. **Confirmar configuraciÃ³n JWT** en Planning Service vs Identity Service
3. **Validar permisos del rol "Entrenador"** para rutinas

### **VALIDACIONES:**
1. Â¿El Planning Service puede decodificar este token?
2. Â¿QuÃ© error especÃ­fico devuelve internamente?
3. Â¿Las claves secretas coinciden entre servicios?

### **TESTING:**
Probar estos endpoints con el token proporcionado:
- `GET /planning/v1/routines`
- `GET /planning/v1/exercises?sportId=1`
- `POST /planning/v1/assignments`
- `GET /planning/v1/assignments/me`

---

## ğŸ¯ **URGENCIA ALTA**

Sin acceso al Planning Service, **TODAS las funcionalidades de rutinas fallan**:
- âŒ Crear rutinas
- âŒ Asignar rutinas  
- âŒ Ver rutinas del atleta
- âŒ Gestionar rutinas del coach

**El frontend estÃ¡ 100% listo, solo necesita que Planning Service acepte tokens vÃ¡lidos.**

---

## ğŸ“ **INFORMACIÃ“N ADICIONAL**

- **Usuario afectado**: `amizaday.dev@gmail.com` (Entrenador)
- **Timestamp**: 2025-01-30 ~15:00 GMT
- **Browser**: Chrome/Web
- **Frontend**: Funcionando correctamente, enviando headers apropiados

**Â¿Pueden verificar la configuraciÃ³n JWT del Planning Service?** 