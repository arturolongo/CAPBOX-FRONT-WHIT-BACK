ğŸš¨ PLANNING SERVICE - DIAGNÃ“STICO ACTUAL Y PRÃ“XIMOS PASOS
========================================================

## ğŸ“‹ ESTADO ACTUAL

### âœ… IMPLEMENTACIONES COMPLETADAS:

1. **Backend Planning Service:**
   - JWT Strategy actualizada con issuer/audience validation
   - Variables de entorno configuradas en cÃ³digo
   - Deploy realizado

2. **Frontend:**
   - RoutineService, ExerciseService, AssignmentService implementados
   - PÃ¡ginas de rutinas completamente funcionales
   - Logs detallados para debugging
   - BotÃ³n temporal de "Token Fresco" agregado

### âŒ PROBLEMA PERSISTENTE:

**Planning Service sigue rechazando tokens con 401 Unauthorized**

```
ğŸ” AUTH INTERCEPTOR: Token expirado o invÃ¡lido - usuario debe reautenticarse
âŒ API: Error en GET /planning/v1/routines?nivel=Principiante - 401
âŒ [RoutineService] ERROR obteniendo rutinas: 401 Unauthorized
```

---

## ğŸ” DIAGNÃ“STICO DETALLADO

### **Token Status:**
- âœ… **Identity Service** acepta el token (login, usuarios, gimnasios funcionan)
- âŒ **Planning Service** rechaza el mismo token (routines, exercises fallan)
- ğŸ”„ **Misma sesiÃ³n** - token vÃ¡lido para un servicio, invÃ¡lido para otro

### **ConfiguraciÃ³n Esperada:**
```
JWT_ISSUER_URL=https://web-87pckv3zfk3q.up-de-fra1-k8s-1.apps.run-on-seenode.com 
JWT_AUDIENCE=capbox-app
JWT_SECRET=UN_SECRETO_DE_PRODUCCION_LARGO_Y_COMPLEJO
```

---

## ğŸ› ï¸ ACCIONES REQUERIDAS BACKEND

### **1. VERIFICAR VARIABLES DE ENTORNO EN SEENODE:**

**Â¿EstÃ¡n configuradas estas variables para ms-planificacion?**
- `JWT_ISSUER_URL`
- `JWT_AUDIENCE` 
- `JWT_SECRET`

**Comando para verificar:**
```bash
# En Seenode dashboard o CLI:
echo $JWT_ISSUER_URL
echo $JWT_AUDIENCE
echo $JWT_SECRET
```

### **2. VERIFICAR LOGS DEL PLANNING SERVICE:**

**Buscar en logs del ms-planificacion:**
- Errores de JWT validation
- "Invalid issuer" o "Invalid audience"
- "Secret mismatch" o similar
- Errores al leer variables de entorno

### **3. CONFIRMAR REINICIO DEL SERVICIO:**

**Â¿Se reiniciÃ³ ms-planificacion despuÃ©s de:**
- Agregar las variables de entorno
- Hacer el deploy del cÃ³digo actualizado

### **4. VERIFICAR SINCRONIZACIÃ“N:**

**Â¿ms-identidad y ms-planificacion usan:**
- El mismo JWT_SECRET?
- El mismo JWT_ISSUER_URL?
- El mismo JWT_AUDIENCE?

---

## ğŸ§ª PRUEBAS FRONTEND

### **Token Fresco Disponible:**
- BotÃ³n "ğŸ”„ Token Fresco (Debug)" agregado en /coach-manage-routines
- Fuerza logout completo y login nuevo
- Permite probar con token reciÃ©n generado

### **PrÃ³ximas Pruebas:**
1. **Usar botÃ³n debug** para token fresco
2. **Probar Planning Service** inmediatamente despuÃ©s de login
3. **Verificar si el problema persiste** con token nuevo

---

## ğŸ“Š ENDPOINTS A VALIDAR

Una vez resuelto el 401, estos endpoints deben funcionar:

```
âœ… GET /planning/v1/routines?nivel=Principiante
âœ… GET /planning/v1/routines?nivel=Intermedio  
âœ… GET /planning/v1/routines?nivel=Avanzado
âœ… GET /planning/v1/exercises?sportId=1
âœ… POST /planning/v1/assignments
âœ… GET /planning/v1/assignments/me
```

---

## ğŸ¯ RESOLUCIÃ“N ESPERADA

**Una vez configuradas las variables y reiniciado el servicio:**

1. Planning Service validarÃ¡ correctamente el JWT
2. Frontend podrÃ¡ cargar rutinas sin errores 401
3. Funcionalidad completa de rutinas estarÃ¡ operativa

---

## ğŸ“ COORDINACIÃ“N

**Frontend estÃ¡ listo y esperando** que Planning Service acepte tokens vÃ¡lidos.

**Â¿Pueden confirmar el estado de las variables de entorno y logs del Planning Service?** 