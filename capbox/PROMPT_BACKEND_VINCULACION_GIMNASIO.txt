ğŸš¨ PROMPT URGENTE PARA BACKEND - SOLICITUDES PENDIENTES NO SE ELIMINAN

ğŸ“‹ PROBLEMA IDENTIFICADO:
âœ… VINCULACIÃ“N CORREGIDA: El problema de vinculaciÃ³n ya fue resuelto en el frontend.

âŒ NUEVO PROBLEMA: Las solicitudes pendientes NO se eliminan despuÃ©s de aprobar un atleta.

**EVIDENCIA DEL PROBLEMA**:

1. âœ… **AprobaciÃ³n exitosa**:
   ```
   âœ… API: Atleta aprobado exitosamente
   âœ… GYM: Atleta aprobado exitosamente con datos completos
   ```

2. âœ… **Atleta aparece en miembros**:
   ```json
   {
     "id": "165d9e1f-8c78-44d5-924c-8550059670d3",
     "nombre": "Arturo Box", 
     "email": "amizaday.dev@gmail.com",
     "rol": "Atleta",
     "nivel": "principiante"
   }
   ```

3. âŒ **Pero solicitud sigue pendiente**:
   ```
   ğŸ“Š APROBACIÃ“N: Solicitudes pendientes despuÃ©s de aprobaciÃ³n: 1
   ğŸ“‹ APROBACIÃ“N: Solicitud pendiente - Arturo Box (165d9e1f-8c78-44d5-924c-8550059670d3)
   âœ… GYM: 1 solicitudes pendientes
   ```

ğŸ” ANÃLISIS DEL PROBLEMA:

El endpoint `/identity/v1/atletas/{id}/aprobar` SÃ aprueba correctamente al atleta (aparece en miembros), pero NO elimina la solicitud pendiente de la tabla de solicitudes.

ğŸ“Š ENDPOINTS INVOLUCRADOS:
1. **POST** `/identity/v1/atletas/{id}/aprobar` âœ… Funciona (aprueba)
2. **GET** `/identity/v1/requests/pending` âŒ Sigue devolviendo solicitud aprobada

ğŸ¯ SOLUCIÃ“N REQUERIDA:

El endpoint de aprobaciÃ³n debe hacer dos acciones:
1. âœ… **Aprobar al atleta** (ya funciona)
2. âŒ **ELIMINAR la solicitud pendiente** (NO funciona)

ğŸ”§ POSIBLES CAUSAS:

1. **Falta eliminaciÃ³n**: El endpoint de aprobaciÃ³n no elimina la solicitud de la tabla `pending_requests`
2. **TransacciÃ³n incompleta**: La aprobaciÃ³n no estÃ¡ vinculada con la eliminaciÃ³n de solicitud
3. **CondiciÃ³n incorrecta**: La eliminaciÃ³n puede tener una condiciÃ³n que no se cumple

ğŸ“‹ ACCIÃ“N REQUERIDA:

Por favor, revisar y corregir el endpoint:

**POST** `/identity/v1/atletas/{id}/aprobar`

Debe incluir la eliminaciÃ³n de la solicitud pendiente:

```javascript
// PseudocÃ³digo de la correcciÃ³n necesaria
async function aprobarAtleta(atletaId, datos) {
  const transaction = await db.beginTransaction();
  try {
    // 1. Aprobar atleta (ya funciona)
    await actualizarEstadoAtleta(atletaId, 'aprobado', datos);
    
    // 2. ELIMINAR solicitud pendiente (FALTA ESTO)
    await eliminarSolicitudPendiente(atletaId);
    
    await transaction.commit();
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}
```

ğŸ¯ RESULTADO ESPERADO:

DespuÃ©s de la correcciÃ³n:
- âœ… El atleta se aprueba correctamente (ya funciona)
- âœ… La solicitud pendiente se ELIMINA (necesita correcciÃ³n)
- âœ… GET `/identity/v1/requests/pending` NO devuelve atletas ya aprobados

âš ï¸ URGENCIA: Este problema estÃ¡ causando confusiÃ³n en la UI del coach, mostrando atletas ya aprobados como pendientes.

---
**Fecha**: Enero 2025
**Prioridad**: ğŸ”´ ALTA
**Estado**: â³ PENDIENTE DE CORRECCIÃ“N EN BACKEND 